# 基于VGG16的表情识别系统

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11.4-blue.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-1.8+-orange.svg)
![Flask](https://img.shields.io/badge/Flask-2.0+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

**基于深度学习的面部表情识别系统，支持7种表情分类**

[功能特性](#-核心特性) • [快速开始](#-快速开始) • [使用文档](#-详细使用说明) • [API文档](#-api接口文档)

</div>

---

## 📖 项目简介

本项目是一个基于**深度学习**的面部表情识别系统，使用**VGG16网络架构**和**小波变换特征融合技术**，实现对7种基本表情的准确识别。系统提供完整的训练、评估和Web部署功能，支持图片上传和实时识别。

### 🎯 项目特点

- 🎯 **高精度识别**：基于VGG16深度神经网络，结合小波变换特征融合，提升识别准确率
- 🚀 **Web部署**：提供现代化的Web界面，支持图片上传和实时识别
- 📊 **完整训练流程**：支持模型训练、验证、评估和可视化
- 🎨 **美观界面**：现代化的UI设计，响应式布局，支持移动端和桌面端
- 📈 **性能监控**：自动生成训练曲线、混淆矩阵等可视化结果
- 🔬 **技术创新**：结合小波变换和CNN特征，实现更优的特征表示

### 📋 支持的表情类别

系统支持识别以下7种基本表情：

- **愤怒 (Anger)** - 红色标识
- **厌恶 (Disgust)** - 棕色标识
- **恐惧 (Fear)** - 紫色标识
- **快乐 (Happy)** - 橙色标识
- **中性 (Neutral)** - 灰色标识
- **悲伤 (Sad)** - 蓝色标识
- **惊讶 (Surprise)** - 深橙红色标识

### 🎯 应用场景

- **心理学研究**：情感分析和情绪识别研究
- **人机交互**：智能交互系统、虚拟助手
- **教育领域**：学习状态监测、课堂情绪分析
- **医疗健康**：心理健康评估、情绪障碍辅助诊断
- **安防监控**：公共场所情绪监测、异常行为检测
- **商业应用**：客户情绪分析、服务质量评估
- **娱乐应用**：表情识别游戏、AR滤镜

## ✨ 核心特性

### 1. 深度学习模型
- **VGG16架构**：使用经典的VGG16网络作为特征提取器
- **迁移学习**：基于ImageNet预训练权重进行微调
- **特征融合**：结合小波变换特征和CNN特征，提升识别准确率
- **7类分类**：支持7种基本表情的精确分类

### 2. 训练和评估
- **完整训练流程**：支持数据加载、模型训练、验证和评估
- **可视化工具**：自动生成准确率曲线、损失曲线和混淆矩阵
- **模型保存**：自动保存最佳模型权重
- **性能评估**：计算准确率、精确率、召回率和F1分数

### 3. Web应用
- **现代化界面**：美观的Web界面设计，支持响应式布局
- **图片识别**：支持图片上传和拖拽上传
- **实时预览**：上传后即时预览图片
- **结果展示**：识别结果分类展示，不同表情使用不同颜色标识
- **置信度显示**：显示识别置信度（百分比）

### 4. 技术亮点
- **小波特征提取**：使用Haar小波变换提取图像频域特征
- **特征融合策略**：图像特征与小波特征的智能融合
- **高效数据处理**：支持多进程数据加载，加速训练过程
- **错误处理**：完善的异常处理和错误提示机制

## 🏗️ 技术架构

### 模型架构
- **基础网络**：VGG16（Visual Geometry Group 16）
- **特征提取**：CNN特征 + 小波变换特征
- **分类器**：7类全连接层
- **输入尺寸**：48x48像素
- **输出**：7类表情概率分布

### 技术栈
- **深度学习框架**：PyTorch
- **Web框架**：Flask
- **图像处理**：PIL, OpenCV, PyWavelets
- **数据处理**：NumPy, Pandas
- **可视化**：Matplotlib, Seaborn
- **评估指标**：Scikit-learn

## 📁 项目结构

```
vggnet/
├── web.py                 # Flask Web服务器主文件
├── train.py              # 模型训练脚本
├── predict.py            # 模型预测脚本
├── model.py              # VGG模型定义
├── my_dataset.py         # 自定义数据集类
├── utils.py              # 工具函数（数据划分等）
├── load_weights.py       # 权重加载工具
├── class_indices.json    # 类别索引映射
│
├── ModelFile/            # 模型文件目录
│   ├── vgg.pth          # 训练好的模型权重
│   └── vgg16-pre.pth    # VGG16预训练权重
│
├── datasets/             # 数据集目录
│   └── data/            # 数据文件
│       ├── angry/       # 愤怒表情图片
│       ├── disgust/     # 厌恶表情图片
│       ├── fear/        # 恐惧表情图片
│       ├── happy/       # 快乐表情图片
│       ├── neutral/     # 中性表情图片
│       ├── sad/         # 悲伤表情图片
│       └── surprise/    # 惊讶表情图片
│
├── templates/            # HTML模板目录
│   └── up.html         # 表情识别Web界面
│
├── static/              # 静态文件目录
│   └── js/             # JavaScript文件
│       └── jquery.min.js
│
├── results/             # 结果文件目录
│   ├── acc.png         # 准确率曲线
│   ├── loss.png        # 损失曲线
│   └── reConfusionMatrix.tif  # 混淆矩阵
│
└── README.md            # 项目说明文档
```

## ⚙️ 环境要求

### Python版本
- Python 3.11.4

### 依赖包
```
torch>=1.8.0
torchvision>=0.9.0
flask>=2.0.0
flask-cors>=3.0.0
opencv-python>=4.5.0
pillow>=8.0.0
numpy>=1.19.0
pywavelets>=1.1.0
matplotlib>=3.3.0
seaborn>=0.11.0
scikit-learn>=0.24.0
tqdm>=4.60.0
```

### 硬件要求
- **GPU**：推荐使用NVIDIA GPU（CUDA支持）以加速训练和推理
- **内存**：至少8GB RAM
- **存储**：至少2GB可用空间


## 📖 详细使用说明

### 1. 训练模型

#### 基本训练
```bash
python train.py
```

训练脚本会执行以下操作：
- 自动划分训练集和验证集（默认8:2）
- 加载VGG16预训练权重
- 进行模型训练（默认50个epoch）
- 自动保存最佳模型权重到 `ModelFile/vgg.pth`
- 生成训练曲线（准确率、损失）和混淆矩阵

#### 训练参数配置
在 `train.py` 中可以修改以下参数：
- `epochs`: 训练轮数（默认50）
- `batch_size`: 批次大小（默认16）
- `learning_rate`: 学习率（默认0.0001）
- `data_path`: 数据集路径
- `val_rate`: 验证集比例（默认0.2）

#### 训练输出
训练完成后会生成：
- `ModelFile/vgg.pth`: 最佳模型权重
- `results/acc.png`: 准确率曲线
- `results/loss.png`: 损失曲线
- `results/reConfusionMatrix.tif`: 混淆矩阵

### 2. 评估模型

#### 评估输出
评估脚本会：
- 加载训练好的模型权重
- 在验证集上进行预测
- 计算评估指标：
  - 准确率 (Accuracy)
  - 精确率 (Precision)
  - 召回率 (Recall)
  - F1分数 (F1-Score)
- 生成混淆矩阵图片

### 3. 启动Web服务

#### 启动服务
```bash
python web.py
```

服务启动后，会显示：
```
 * Running on http://0.0.0.0:5000
```

#### 访问Web界面
在浏览器中访问：
```
http://localhost:5000
```

#### 停止服务
按 `Ctrl+C` 停止服务

### 4. 使用Web界面

#### 图片识别步骤
1. **上传图片**
   - 点击"选择图片"按钮选择文件
   - 或直接拖拽图片到上传区域

2. **预览图片**
   - 上传后自动显示图片预览
   - 支持JPG、JPEG、PNG、BMP格式

3. **开始识别**
   - 点击"开始识别"按钮
   - 等待识别完成（通常<1秒）

4. **查看结果**
   - 识别结果显示在右侧
   - 显示表情类别和置信度
   - 不同表情使用不同颜色标识

#### 界面功能
- ✅ 图片预览
- ✅ 拖拽上传
- ✅ 实时识别
- ✅ 结果展示
- ✅ 置信度显示
- ✅ 响应式布局

## 🔬 技术实现细节

### 1. 数据预处理

**训练集预处理**：
- 随机裁剪并调整大小为48x48
- 随机水平翻转（数据增强）
- 转换为张量
- ImageNet标准化

**验证集预处理**：
- 调整大小为256x256
- 中心裁剪为48x48
- 转换为张量
- ImageNet标准化

### 2. 特征提取

**小波变换特征**：
- 使用Haar小波基函数
- 1级小波分解
- 提取近似系数作为特征
- 使用双线性插值调整特征尺寸

**CNN特征**：
- VGG16网络提取深度特征
- 融合小波特征和CNN特征
- 特征融合方式：逐元素相加

### 3. 模型训练

**训练策略**：
- 迁移学习：使用ImageNet预训练权重
- 微调：只训练分类器层
- 优化器：Adam优化器
- 学习率：0.0001
- 损失函数：交叉熵损失

**训练流程**：
1. 加载预训练权重
2. 修改分类器层（7类输出）
3. 冻结特征提取层（可选）
4. 训练分类器层
5. 保存最佳模型

### 4. 模型推理

**推理流程**：
1. 加载图像并预处理
2. 提取小波特征
3. 提取CNN特征
4. 特征融合
5. 模型前向传播
6. Softmax获取概率分布
7. 返回预测结果和置信度

## 📊 性能指标

### 模型性能
- **准确率**：根据训练结果而定
- **精确率**：加权平均精确率
- **召回率**：加权平均召回率
- **F1分数**：加权平均F1分数

### 训练指标
- 训练时间：取决于数据集大小和硬件配置
- 推理速度：单张图片识别时间 < 1秒（GPU）
- 模型大小：约500MB（包含预训练权重）

## 📄 文件说明

### 核心文件

- **train.py**: 模型训练脚本，包含训练和评估功能
- **predict.py**: 模型预测脚本，支持单张图片预测
- **web.py**: Flask Web服务器，提供API和Web界面
- **model.py**: VGG模型定义，包含模型架构
- **my_dataset.py**: 自定义数据集类，支持小波特征提取
- **utils.py**: 工具函数，包含数据划分等功能

### 配置文件

- **class_indices.json**: 类别索引到类别名称的映射
- **vgg16-pre.pth**: VGG16预训练权重文件
- **vgg.pth**: 训练好的模型权重文件

## 🛠️ 开发说明

### 修改模型配置

在 `train.py` 中可以修改：
- 训练轮数（epochs）
- 批次大小（batch_size）
- 学习率（learning_rate）


### 修改预测配置

在 `predict.py` 中可以修改：
- 模型权重路径
- 小波变换参数（wavelet, level）
- 图像预处理参数

### 修改Web配置

在 `web.py` 中可以修改：
- 服务器端口（默认5000）
- 允许的文件类型
- 临时文件处理方式
